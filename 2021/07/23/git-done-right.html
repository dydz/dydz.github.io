<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Git Done Right | Daniel Bates</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Git Done Right" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My workflow for breaking apart work into logical commits so that 1 patch is equal to 1 commit. Always rebase and optionally git merge. Don’t just git merge." />
<meta property="og:description" content="My workflow for breaking apart work into logical commits so that 1 patch is equal to 1 commit. Always rebase and optionally git merge. Don’t just git merge." />
<link rel="canonical" href="https://dabates.com/2021/07/23/git-done-right.html" />
<meta property="og:url" content="https://dabates.com/2021/07/23/git-done-right.html" />
<meta property="og:site_name" content="Daniel Bates" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-23T06:39:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Git Done Right" />
<script type="application/ld+json">
{"headline":"Git Done Right","dateModified":"2021-07-23T06:39:00+00:00","datePublished":"2021-07-23T06:39:00+00:00","description":"My workflow for breaking apart work into logical commits so that 1 patch is equal to 1 commit. Always rebase and optionally git merge. Don’t just git merge.","url":"https://dabates.com/2021/07/23/git-done-right.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dabates.com/2021/07/23/git-done-right.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://dabates.com/feed.xml" title="Daniel Bates" /><meta http-equiv="Content-Security-Policy" content="default-src 'self'">
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Daniel Bates</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
<div class="wrapper">
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Git Done Right</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-07-23T06:39:00+00:00" itemprop="datePublished">
        Jul 23, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="whats-this-about">What’s this about?</h1>

<p>This is a post about a good development workflow with Git that will ensure that 1) well-documented commits that don’t break the build or tests are made and 2) that the history of the repo is easy to bisect to find regressions or progressions.</p>

<p>How is this accomplished? By doing a successful <a href="https://www.youtube.com/watch?v=0n_J2z-ILXo" target="_blank" rel="noreferrer noopener">Humpty Dumpty</a>:</p>

<blockquote>
  <p>Humpty Dumpty sat on a wall.<br />Humpty Dumpty had a great fall.<br />All the king’s horses and all the king’s men.<br />
<del>Couldn’t</del> Put Humpty together again.</p>
</blockquote>

<p>First I’m going to show how to break up a code change. Then I’m going to show how to merge these code changes into the repo.</p>

<h1 id="break-apart-work-into-logical-commits">Break apart work into logical commits</h1>

<p>Before I can get to using Git right, the basic development workflow needs to be right. The basic unit of measure in this discussion is the patch, which I will refer interchangeably with the word commit throughout the rest of this note unless otherwise noted and I’ll explain why in a moment. To be precise a commit is its own logical unit that represents one or more patches applied to a source control management system (aka repository). So, why will I be using patch and commit interchangeably? Because…</p>

<h2 id="1-patch-to-1-commit">1 Patch to 1 Commit</h2>

<p>The right way to do software engineering is to identify a small, easily reviewed, logical change (SLC) that does not break the build or tests.</p>

<p>Be practical when making this determination: if a change can’t be made small then choose the smallest that is still a logical change. For example, logically you might be able to divide up a large refactoring change into several trivial refactoring changes, but it may be more practical to propose or commit them together.</p>

<p>The SLC should be represented in 1 patch that is then applied to the repository in 1 commit. Why? Because:</p>

<ol>
  <li>It is easier to review and check correctness of small changes than large ones. Why is it easier to review? Smaller changes have less characters to read. They also make it easier to keep discussions focused on the small details to ensure correctness.</li>
  <li>It can be easily and cleanly reverted if it’s wrong.</li>
  <li>It makes it easy to bisect commits (i.e. use “git bisect”) to find regressions and progressions.</li>
</ol>

<p>Finding the SLC is a skill, but here’s a general strategy I do when I can’t identify it from the get-go:</p>

<ol>
  <li>Free flow write code and checkpoint my progress via “git commit” whenever I want until I get something working end-to-end.</li>
  <li>Aggressively combine all the commits produced in (1) using “git commit –amend” or “git rebase -i” into logical commits.</li>
</ol>

<p>This results in one or more SLC commits. Nobody knows how many times I had to fix some silly syntax error or that I forgot to add a file at one point…just like it should be.</p>

<h1 id="rebase-or-merge">Rebase or merge?</h1>

<p>Now that 1 patch is 1 commit we can get to the primary motivation for this post. What is the best merge strategy?</p>

<p>Rebase locally then optionally merge.</p>

<p>Why? Because:</p>

<ol>
  <li>It helps ensure that each SLC is conflict free, which is required to not break the build.</li>
  <li>It requires that conflicts found in (1)  are addressed in each SLC, which helps also ensure that each SLC does not break the build or tests.</li>
</ol>

<p>After rebasing, a build and test run should be performed and fixes for any failures should be combined with the appropriate SLCs to ensure that each SLC continues to not break the build or tests. When ready to push the changes (to a review branch or to the primary branch), repeat the rebase process until there are 0 conflicts. If working in a topic branch (i.e. a non-primary branch) and pushing to the primary branch (e.g. origin/master) now is the time to optionally merge it using “git merge” and then “git push” to the remote. Otherwise, just push the commits to the remote now.</p>

<p>What is the reason to wait until <strong>after</strong> rebasing to “git merge”? <strong>Why not “git merge” from the get-go?</strong> Doing a “git merge” from the get-go would create a merge commit. If there were any conflicts then they would be resolved here, not in the SLCs. After resolution it is no longer technically correct to call the commits under the merge commit SLCs because they don’t build individually or may cause test failures (or both). This is an important property that should be preserved to make it easy in the future to bisect commits to find a regression or progression. That’s why a “git merge”, if done at all, should be done <strong>after</strong> rebasing.</p>

<p>What’s the benefit of doing a “git merge” then? It really only benefits a repo archeologist: the merge commit marks in the timeline (graphically seen in gitk) that a set of commits originated from a topic branch before being merged into the primary branch. That’s it.</p>


  </div><a class="u-url" href="/2021/07/23/git-done-right.html" hidden></a>
</article>

</div>
</main><footer class="site-footer h-card">
<div class="wrapper"><ul class="social-media-list"><li><a href="https://github.com/dydz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">dydz</span></a></li><li><a href="https://www.linkedin.com/in/daniel-bates-43a2111b"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">daniel-bates-43a2111b</span></a></li><li><a href="https://www.twitter.com/_dydz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">_dydz</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li><li><a href="mailto:dydz%40intudata.com"><span class="username">dydz@intudata.com</span></a></li></ul>
</div>
</footer>
</body>
</html>
